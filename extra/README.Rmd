
```{r most hallucination cases by state table}
state_summary |> arrange(desc(num_cases)) |> head(15)

```


```{r most used ai tools}
library(scales)

ai_tools <- ai_data |>
  separate_rows(ai_tool, sep = ",|/|;") |>
  mutate(
    ai_tool = str_squish(ai_tool),
    ai_tool = recode(ai_tool,
      "ChatGPT" = "OpenAI ChatGPT",
      "GPT-4" = "OpenAI ChatGPT",
      "GPT4" = "OpenAI ChatGPT",
      "Google Gemini" = "Gemini",
      "Google Bard" = "Gemini",
      "Bard" = "Gemini",
      "Claude" = "Anthropic Claude",
      "implied" = "Implied",
      "Copilot" = "MS Copilot",
      "Microsoft CoPilot" = "MS Copilot",
      "CoPilot" = "MS Copilot",
      "Internet searches" = "Internet Search"
    )
  ) |>
  drop_na(ai_tool)

llm_summary <- ai_tools |>
  count(ai_tool, name = "freq", sort = TRUE)

llm_top <- llm_summary |> 
  head(10)

# Top 10 LLM frequency plot
max_freq <- max(llm_summary$freq, na.rm = TRUE)
step <- ceiling(max_freq / 5)  

ggplot(llm_top |> slice_max(freq, n = 10),
       aes(x = reorder(ai_tool, freq), y = freq)) +
  geom_col(fill = "#69b3a2") +
  coord_flip() +
  scale_y_continuous(
    breaks = seq(0, max_freq, by = step),  # manually control tick spacing
    labels = comma_format()
  ) +
  labs(
    title = "Top 10 AI Tools Involved in Hallucination Cases",
    x = "AI Tool",
    y = "Frequency"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.y = element_text(size = 10),
    axis.text.x = element_text(size = 9),
    panel.grid.minor = element_blank(),
  )

# All LLM frequency plot
max_freq <- max(llm_summary$freq, na.rm = TRUE)
step <- ceiling(max_freq / 5)  # ticks across axis

ggplot(llm_summary |> slice_max(freq, n = 10),
       aes(x = reorder(ai_tool, freq), y = freq)) +
  geom_col(fill = "#69b3a2") +
  coord_flip() +
  scale_y_continuous(
    breaks = seq(0, max_freq, by = step),  # manually control tick spacing
    labels = comma_format()
  ) +
  labs(
    title = "AI Tools Involved in Hallucination Cases",
    x = "AI Tool",
    y = "Frequency"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.y = element_text(size = 10),
    axis.text.x = element_text(size = 9),
    panel.grid.minor = element_blank(),
  )

######
ai_data %>%
  ggplot(aes(x = hallucination)) +
  geom_bar(
    fill = "#69b3a2",
    color = "#e9ecef",
    alpha = 0.9
  ) +
  ggtitle("Hallucination Types by AI Tool") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ai_data |>
  count(hallucination, sort = TRUE) |>
  slice_max(n, n = 10) |>
  ggplot(aes(x = reorder(hallucination, n), y = n)) +
  geom_col(fill = "grey") +
  coord_flip() +
  labs(title = "Frequency of AI Hallucinations",
       x = "Type of Hallucination", y = "Frequency") +
  theme_minimal()
```

```{r timeline of increase in cases}

## Maybe separate into different LLM types - so we can see the spike in usage for each LLM
library(scales)

ai_data |>
mutate(year = lubridate::year(date)) |>
count(year) |>
ggplot(aes(x = year, y = n)) +
geom_line(linewidth = 1.2, color = "#FF6666") +
geom_point(size = 2) +
scale_x_continuous(breaks = pretty_breaks()) +
labs(title = "Trend of AI Hallucination Cases Over Time",
x = "Year", y = "Number of Cases") +
theme_minimal()

```

```{r top-tools, fig.alt = "Horizontal bar chart of the frequency of the top 10 most used AI tools in hallucination cases. Implied, Unidentified, and Chat GPT were used the most, with noticeably higher frequencies than the other AI tools.}
max_freq <- max(llm_summary$freq, na.rm = TRUE)
step <- ceiling(max_freq / 5)  

ggplot(llm_top |> slice_max(freq, n = 10),
       aes(x = reorder(ai_tool, freq), y = freq)) +
  geom_col(fill = "#69b3a2") +
  coord_flip() +
  scale_y_continuous(
    breaks = seq(0, max_freq, by = step),  # manually control tick spacing
    labels = comma_format()
  ) +
  labs(
    title = "Top 10 AI Tools Involved in Hallucination Cases",
    x = "AI Tool",
    y = "Frequency"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.y = element_text(size = 10),
    axis.text.x = element_text(size = 9),
    panel.grid.minor = element_blank(),
  )

```


```{r monthly-stacked-area, message = FALSE, warning = FALSE}
library(tidyverse)
library(lubridate)

parties <- c("Pro Se Litigant", "Lawyer")

month_df <- ai_data |>
  mutate(
    Date = as.Date(date),
    year = year(Date)
  ) |>
  filter(
    year >= 2023, year <= 2025,
    party %in% parties
  ) |>
  mutate(
    month = floor_date(Date, unit = "month")
  ) |>
  count(month, party, name = "n") |>
  mutate(
    party = factor(party, levels = c("Pro Se Litigant", "Lawyer"))
  )

max_total <- month_df |>
  group_by(month) |>
  summarise(total = sum(n), .groups = "drop") |>
  summarise(max_total = max(total)) |>
  pull(max_total)

upper_lim <- ceiling((max_total + 5) / 5) * 5 

ggplot(month_df,
       aes(x = month, y = n, fill = party)) +
  geom_area(alpha = 0.85, color = "white", linewidth = 0.2) +
  scale_fill_brewer(palette = "Paired") +
  scale_x_date(
    date_breaks = "2 months",
    date_labels = "%Y-%m",
    expand = expansion(mult = c(0.02, 0.05))
  ) +
  scale_y_continuous(
    limits = c(0, upper_lim),            
    breaks = seq(0, upper_lim, 10), 
    minor_breaks = seq(0, upper_lim, 5),
    expand = expansion(mult = c(0, 0))
  ) +
  labs(
    title    = "Monthly Hallucination-Related Cases (2023–2025)",
    subtitle = "Stacked Area Plot",
    x        = "Monthly Period",
    y        = "Number of Cases",
    fill     = "Party Type"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    axis.text.x   = element_text(angle = 45, hjust = 1, vjust = 1),
    axis.title.x   = element_text(size = 9),
    axis.title.y   = element_text(size = 9),
    plot.title    = element_text(size = 12, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 10, hjust = 0.5),
    legend.position = c(0.05, 0.9),
    legend.justification = c("left", "top"),
    legend.background = element_rect(fill = "white", color = NA),
    legend.title = element_text(size = 10),
    legend.text  = element_text(size = 9),
    legend.key.size = unit(0.6, "lines")
  )
```


```{r bimonthly-avg-by-party, message = FALSE, warning = FALSE}
library(tidyverse)
library(lubridate)

# Parties to include
parties <- c("Lawyer", "Pro Se Litigant")

bi_df <- ai_data |>
  mutate(
    Date = as.Date(date),
    year = year(Date)
  ) |>
  # keep 2023–2025 and only these two party types
  filter(
    year >= 2023, year <= 2025,
    party %in% parties
  ) |>
  # bimonthly period (Jan–Feb, Mar–Apr, etc.)
  mutate(
    bimonth = floor_date(Date, unit = "2 months")
  ) |>
  # number of cases in each bimonthly period and party
  count(bimonth, party, name = "avg_cases")

# order parties for legend
bi_df <- bi_df |>
  mutate(party = factor(party, levels = parties))

ggplot(bi_df, aes(x = bimonth, y = avg_cases, colour = party)) +
  geom_line(linewidth = 0.8) +
  geom_point(size = 2) +
  scale_x_date(
    date_breaks = "2 months",
    date_labels = "%Y-%m"
  ) +
  labs(
    title = "Bimonthly Average Hallucination-Related Cases (2023–2025)",
    x = "Bimonthly Period",
    y = "Average Number of Cases",
    colour = NULL
  ) +
  theme_minimal(base_size = 13) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title  = element_text(face = "bold", hjust = 0.5),
    legend.position = "top"
  )
```

```{r state-pie-map, message = FALSE, warning = FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(maps)
library(scatterpie)
library(stringr)
library(scales)

state_rep <- ai_data |>
  filter(!is.na(court_location)) |>
  mutate(
    rep_type = case_when(
      str_detect(party, regex("pro se", ignore_case = TRUE)) ~ "Pro se litigant",
      TRUE ~ "Lawyer"
    )
  ) |>
  count(court_location, rep_type, name = "n")

state_rep_wide <- state_rep |>
  tidyr::pivot_wider(
    names_from  = rep_type,
    values_from = n,
    values_fill = 0
  ) |>
  rename(
    pro_se = `Pro se litigant`,
    lawyer = Lawyer
  ) |>
  mutate(total_cases = pro_se + lawyer)

state_centers <- tibble::tibble(
  court_location = state.name,
  long = state.center$x,
  lat  = state.center$y
) |>
  add_row(court_location = "Puerto Rico", long = -66.5, lat = 18.2)

state_pies <- state_rep_wide |>
  inner_join(state_centers, by = "court_location") |>
  mutate(
    radius = scales::rescale(sqrt(total_cases), to = c(0.4, 1.2))
  )

us_map <- map_data("state")

ggplot() +
  geom_polygon(
    data  = us_map,
    aes(x = long, y = lat, group = group),
    fill  = "#e6ffe6",
    color = "white"
  ) +
  scatterpie::geom_scatterpie(
    data = state_pies,
    aes(x = long, y = lat, r = radius),
    cols  = c("pro_se", "lawyer"),
    color = NA
  ) +
  coord_fixed(1.3) +
  scale_fill_manual(
    name   = NULL,
    values = c(pro_se = "#e41a1c", lawyer = "#377eb8"),
    labels = c("Pro se litigant", "Lawyer")
  ) +
  labs(
    title    = "AI Hallucination Cases by State",
    subtitle = "Pie size = total cases; slices = pro se vs lawyer"
  ) +
  theme_void() +
  theme(
    legend.position = "right",
    plot.title      = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle   = element_text(hjust = 0.5)
  )

```

```{r state-pie-map, message = FALSE, warning = FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(maps)
library(scatterpie)
library(stringr)
library(scales)

ai_data_outcome <- ai_data |>
  mutate(
    outcome_simple = case_when(
      outcome %in% c("Warning", "Dismissed", "Pending", "Penalized") ~ outcome,
      TRUE ~ NA_character_
    ),
    court_location = str_to_title(court_location)
  ) |>
  filter(!is.na(outcome_simple)) |>
  filter(!court_location %in% c("Hawaii", "Puerto Rico"))


state_outcome <- ai_data_outcome |>
  filter(!is.na(court_location)) |>
  count(court_location, outcome_simple, name = "n")

state_outcome_wide <- state_outcome |>
  pivot_wider(
    names_from  = outcome_simple,
    values_from = n,
    values_fill = 0
  ) |>
  mutate(total_cases = rowSums(across(-court_location)))

state_centers <- tibble::tibble(
  court_location = state.name,
  long = state.center$x,
  lat  = state.center$y
) |>
  filter(!court_location %in% c("Hawaii", "Puerto Rico"))

state_pies <- state_outcome_wide |>
  inner_join(state_centers, by = "court_location") |>
  mutate(
    radius = scales::rescale(sqrt(total_cases), to = c(0.4, 1.2))
  )

pie_cols <- c("Warning", "Dismissed", "Pending", "Penalized")

okabe_ito <- c(
  "Warning"   = "#F46D43FF", 
  "Dismissed" = "#4575B4FF", 
  "Pending"   = "#FDAE61FF", 
  "Penalized" = "#D73027FF"  
)

us_map <- map_data("state") |>
  mutate(region = str_to_title(region)) |>
  filter(!region %in% c("Hawaii"))

ggplot() +
  geom_polygon(
    data = us_map,
    aes(x = long, y = lat, group = group),
    fill = "#ABD9E9FF",
    color = "white"
  ) +
  scatterpie::geom_scatterpie(
    data = state_pies,
    aes(x = long, y = lat, r = radius),
    cols = pie_cols,
    color = NA
  ) +
  coord_fixed(1.3) +
  scale_fill_manual(
    name = "Outcome",
    values = okabe_ito
  ) +
  labs(
    title = "AI Hallucination Cases and Corresponding Outcome by State",
  ) +
  theme_void() +
  theme(
    legend.position = "right",
    plot.title      = element_text(hjust = 0.5),
    plot.subtitle   = element_text(hjust = 0.5),
    legend.background     = element_rect(fill = "white", colour = "black", size = 0.3),
    legend.box.background = element_rect(fill = "white", colour = "black", size = 0.3),
    legend.key            = element_rect(fill = "white", colour = "white"),
    legend.margin         = margin(6, 6, 6, 6),
    legend.title          = element_text(face = "bold")
  )
```


```{r}
library(tidyverse)
library(lubridate)
library(scales)

monthly_tools <- ai_data |>
  mutate(
    date  = ymd(date),
    month = floor_date(date, "month")
  ) |>
  filter(!is.na(`ai_tool`)) |>
  mutate(
    tool = case_when(
      str_detect(`ai_tool`, regex("chatgpt", ignore_case = TRUE))        ~ "OpenAI ChatGPT",
      str_detect(`ai_tool`, regex("copilot", ignore_case = TRUE))        ~ "MS Copilot",
      str_detect(`ai_tool`, regex("gemini|bard", ignore_case = TRUE))    ~ "Gemini",
      TRUE ~ NA_character_
    )
  ) |>
  filter(!is.na(tool)) |>
  count(month, tool, name = "n")

tool_order <- monthly_tools |>
  group_by(tool) |>
  summarise(total = sum(n), .groups = "drop") |>
  arrange(desc(total)) |>
  pull(tool)

monthly_tools <- monthly_tools |>
  mutate(tool = factor(tool, levels = tool_order))

max_cases <- max(monthly_tools$n, na.rm = TRUE)

ggplot(monthly_tools,
       aes(x = month, y = n, colour = tool, group = tool)) +
  geom_line(linewidth = 1) +
  geom_point(size = 1.8) +
  scale_x_date(
  date_breaks = "6 months",
    date_labels = "%Y-%m",
    expand = expansion(mult = c(0.02, 0.05))
  ) +
  scale_y_continuous(
    breaks = seq(0, max_cases, by = 2),       
    limits = c(0, max_cases),
    expand = expansion(mult = c(0.02, 0.05))
  ) +
  scale_colour_brewer(palette = "Dark2", name = "LLM Type") + 
  labs(
    title  = "Trend of AI Hallucination Cases by Most Used LLM Type(2023-2025)",
    x      = "Time Period",
    y      = "Number of Cases"
  ) +
  theme_minimal() +
  theme(
    axis.text.x  = element_text(hjust = 1),
    axis.title.x = element_text(size = 12),
    axis.title.y = element_text(size = 12),
    plot.title   = element_text(size = 14, hjust = 0.5)
  )
```

```{r}
library(tidyverse)
library(lubridate)
library(scales)

llm_levels <- c(
  "OpenAI ChatGPT",
  "MS Copilot",
  "Gemini",
  "Anthropic Claude",
  "Implied/Other"
)

llm_month_df <- ai_data |>
  mutate(
    Date = as.Date(date),
    year = year(Date)
  ) |>
  filter(
    year >= 2023, year <= 2025,
    !is.na(ai_tool)
  ) |>
  mutate(
    llm_type = case_when(
      str_detect(ai_tool, regex("chatgpt|gpt-4|gpt4", ignore_case = TRUE)) ~ "OpenAI ChatGPT",
      str_detect(ai_tool, regex("copilot|co-pilot", ignore_case = TRUE))    ~ "MS Copilot",
      str_detect(ai_tool, regex("gemini|bard", ignore_case = TRUE))         ~ "Gemini",
      str_detect(ai_tool, regex("claude", ignore_case = TRUE))              ~ "Anthropic Claude",
      TRUE                                                                  ~ "Implied/Other"
    ),
    month = floor_date(Date, unit = "month")
  ) |>
  count(month, llm_type, name = "n") |>
  mutate(
    llm_type = factor(llm_type, levels = llm_levels)
  )

max_total_llm <- llm_month_df |>
  group_by(month) |>
  summarise(total = sum(n), .groups = "drop") |>
  summarise(max_total = max(total)) |>
  pull(max_total)

upper_lim_llm <- ceiling((max_total_llm + 5) / 5) * 5

ggplot(llm_month_df,
       aes(x = month, y = n, fill = llm_type)) +
  geom_area(alpha = 0.85, color = "white", linewidth = 0.2) +
  scale_fill_brewer(palette = "Accent",
    name = "LLM Type",
    labels = llm_levels) +
  scale_x_date(
    date_breaks = "6 months",
    date_labels = "%Y-%m",
    expand = expansion(mult = c(0.02, 0.05))
  ) +
  scale_y_continuous(
    limits = c(0, upper_lim_llm),
    breaks = seq(0, upper_lim_llm, 10),
    minor_breaks = seq(0, upper_lim_llm, 5),
    expand = expansion(mult = c(0, 0))
  ) +
  labs(
    title    = "AI Hallucination Cases by LLM Type (2023–2025)",
    x        = "Time Period",
    y        = "Number of Cases"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    axis.text.x    = element_text(hjust = 1, vjust = 1),
    axis.title.x   = element_text(size = 11),
    axis.title.y   = element_text(size = 11),
    plot.title     = element_text(size = 14, hjust = 0.5),
    legend.position = c(0.05, 0.9),
    legend.justification = c("left", "top"),
    legend.background = element_rect(fill = "white", color = NA),
    legend.title  = element_text(size = 10),
    legend.text   = element_text(size = 9),
    legend.key.size = unit(0.6, "lines"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )

```

```{r}
library(tidyverse)
library(lubridate)
library(scales)

monthly_tools <- ai_data |>
  mutate(
    date  = ymd(date),
    month = floor_date(date, "month")
  ) |>
  filter(!is.na(ai_tool)) |>
  mutate(
    tool = case_when(
      str_detect(ai_tool, regex("chatgpt", ignore_case = TRUE))     ~ "OpenAI ChatGPT",
      str_detect(ai_tool, regex("copilot", ignore_case = TRUE))     ~ "MS Copilot",
      str_detect(ai_tool, regex("gemini|bard", ignore_case = TRUE)) ~ "Gemini",
      TRUE ~ NA_character_
    )
  ) |>
  filter(!is.na(tool)) |>
  count(month, tool, name = "n")

tool_order <- monthly_tools |>
  group_by(tool) |>
  summarise(total = sum(n), .groups = "drop") |>
  arrange(desc(total)) |>
  pull(tool)

monthly_tools <- monthly_tools |>
  mutate(tool = factor(tool, levels = tool_order))

# For nice y-axis limits like in your party stacked area plot
max_total <- monthly_tools |>
  group_by(month) |>
  summarise(total = sum(n), .groups = "drop") |>
  summarise(max_total = max(total)) |>
  pull(max_total)

upper_lim <- ceiling((max_total + 5) / 5) * 5

ggplot(monthly_tools,
       aes(x = month, y = n, fill = tool)) +
  geom_area(alpha = 0.85, color = "white", linewidth = 0.2) +
  scale_fill_brewer(palette = "Dark2", name = "LLM Type") +
  scale_x_date(
    date_breaks = "2 months",
    date_labels = "%Y-%m",
    expand = expansion(mult = c(0.02, 0.05))
  ) +
  scale_y_continuous(
    limits = c(0, upper_lim),
    breaks = seq(0, upper_lim, 2),
    minor_breaks = seq(0, upper_lim, 1),
    expand = expansion(mult = c(0, 0))
  ) +
  labs(
    title    = "Monthly AI Hallucination Cases by LLM Type (2023–2025)",
    subtitle = "Stacked Area Plot",
    x        = "Monthly Period",
    y        = "Number of Cases"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    axis.text.x    = element_text(angle = 45, hjust = 1, vjust = 1),
    axis.title.x   = element_text(size = 9),
    axis.title.y   = element_text(size = 9),
    plot.title     = element_text(size = 12, face = "bold", hjust = 0.5),
    plot.subtitle  = element_text(size = 10, hjust = 0.5),
    legend.position = c(0.05, 0.9),
    legend.justification = c("left", "top"),
    legend.background = element_rect(fill = "white", color = NA),
    legend.title  = element_text(size = 10),
    legend.text   = element_text(size = 9),
    legend.key.size = unit(0.6, "lines")
  )

```

```{r}
ggplot(hall_outcome,
       aes(x = fct_reorder(outcome, -total_cases),
           y = n_cases,
           fill = hallucination)) +
  geom_col(position = "fill", color = "white") +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  scale_fill_viridis_d(option = "C", name = "Hallucination type") +
  labs(
    title = "Within-Outcome Distribution of Top 5 Hallucination Types",
    x     = "Outcome",
    y     = "Share of cases"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 30, hjust = 1),
    panel.grid.major.x = element_blank()
  )

```
```{r}
ggplot(hall_outcome,
       aes(x = fct_reorder(outcome, -total_cases),
           y = fct_reorder(hallucination, n_cases),
           fill = pct_within_outcome)) +
  geom_tile(color = "white") +
  geom_text(aes(label = percent(pct_within_outcome, accuracy = 1)),
            color = "white", size = 3) +
  scale_fill_viridis_c(
    option = "C",
    direction = 1,
    labels = percent_format(accuracy = 1),
    name = "Share of\ncases in outcome"
  ) +
  labs(
    title   = "Top 5 AI Hallucination Types by Case Outcome",
    x       = "Outcome",
    y       = "Hallucination category",
    caption = "Only the five most common hallucination types are shown."
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 30, hjust = 1),
    panel.grid  = element_blank()
  )

```



```{r}
ggplot(hall_outcome,
       aes(x = fct_reorder(outcome, total_cases),
           y = hallucination,
           size = n_cases,
           fill = hallucination)) +
  geom_point(shape = 21, color = "black", alpha = 0.85) +
  scale_size(range = c(3, 18), name = "Number of Cases") +
  scale_fill_viridis_d(option = "C", guide = "none") +
  labs(
    title = "Bubble Map of Top 5 Hallucination Types by Outcome",
    x = "Outcome",
    y = "Hallucination Category"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    panel.grid.minor = element_blank(),
    axis.text.x = element_text(angle = 25, hjust = 1)
  )

```



