
```{r most hallucination cases by state table}
state_summary |> arrange(desc(num_cases)) |> head(15)

```


```{r most used ai tools}
library(scales)

ai_tools <- ai_data |>
  separate_rows(ai_tool, sep = ",|/|;") |>
  mutate(
    ai_tool = str_squish(ai_tool),
    ai_tool = recode(ai_tool,
      "ChatGPT" = "OpenAI ChatGPT",
      "GPT-4" = "OpenAI ChatGPT",
      "GPT4" = "OpenAI ChatGPT",
      "Google Gemini" = "Gemini",
      "Google Bard" = "Gemini",
      "Bard" = "Gemini",
      "Claude" = "Anthropic Claude",
      "implied" = "Implied",
      "Copilot" = "MS Copilot",
      "Microsoft CoPilot" = "MS Copilot",
      "CoPilot" = "MS Copilot",
      "Internet searches" = "Internet Search"
    )
  ) |>
  drop_na(ai_tool)

llm_summary <- ai_tools |>
  count(ai_tool, name = "freq", sort = TRUE)

llm_top <- llm_summary |> 
  head(10)

# Top 10 LLM frequency plot
max_freq <- max(llm_summary$freq, na.rm = TRUE)
step <- ceiling(max_freq / 5)  

ggplot(llm_top |> slice_max(freq, n = 10),
       aes(x = reorder(ai_tool, freq), y = freq)) +
  geom_col(fill = "#69b3a2") +
  coord_flip() +
  scale_y_continuous(
    breaks = seq(0, max_freq, by = step),  # manually control tick spacing
    labels = comma_format()
  ) +
  labs(
    title = "Top 10 AI Tools Involved in Hallucination Cases",
    x = "AI Tool",
    y = "Frequency"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.y = element_text(size = 10),
    axis.text.x = element_text(size = 9),
    panel.grid.minor = element_blank(),
  )

# All LLM frequency plot
max_freq <- max(llm_summary$freq, na.rm = TRUE)
step <- ceiling(max_freq / 5)  # ticks across axis

ggplot(llm_summary |> slice_max(freq, n = 10),
       aes(x = reorder(ai_tool, freq), y = freq)) +
  geom_col(fill = "#69b3a2") +
  coord_flip() +
  scale_y_continuous(
    breaks = seq(0, max_freq, by = step),  # manually control tick spacing
    labels = comma_format()
  ) +
  labs(
    title = "AI Tools Involved in Hallucination Cases",
    x = "AI Tool",
    y = "Frequency"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.y = element_text(size = 10),
    axis.text.x = element_text(size = 9),
    panel.grid.minor = element_blank(),
  )

######
ai_data %>%
  ggplot(aes(x = hallucination)) +
  geom_bar(
    fill = "#69b3a2",
    color = "#e9ecef",
    alpha = 0.9
  ) +
  ggtitle("Hallucination Types by AI Tool") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ai_data |>
  count(hallucination, sort = TRUE) |>
  slice_max(n, n = 10) |>
  ggplot(aes(x = reorder(hallucination, n), y = n)) +
  geom_col(fill = "grey") +
  coord_flip() +
  labs(title = "Frequency of AI Hallucinations",
       x = "Type of Hallucination", y = "Frequency") +
  theme_minimal()
```

```{r timeline of increase in cases}

## Maybe separate into different LLM types - so we can see the spike in usage for each LLM
library(scales)

ai_data |>
mutate(year = lubridate::year(date)) |>
count(year) |>
ggplot(aes(x = year, y = n)) +
geom_line(linewidth = 1.2, color = "#FF6666") +
geom_point(size = 2) +
scale_x_continuous(breaks = pretty_breaks()) +
labs(title = "Trend of AI Hallucination Cases Over Time",
x = "Year", y = "Number of Cases") +
theme_minimal()

```

```{r top-tools, fig.alt = "Horizontal bar chart of the frequency of the top 10 most used AI tools in hallucination cases. Implied, Unidentified, and Chat GPT were used the most, with noticeably higher frequencies than the other AI tools.}
max_freq <- max(llm_summary$freq, na.rm = TRUE)
step <- ceiling(max_freq / 5)  

ggplot(llm_top |> slice_max(freq, n = 10),
       aes(x = reorder(ai_tool, freq), y = freq)) +
  geom_col(fill = "#69b3a2") +
  coord_flip() +
  scale_y_continuous(
    breaks = seq(0, max_freq, by = step),  # manually control tick spacing
    labels = comma_format()
  ) +
  labs(
    title = "Top 10 AI Tools Involved in Hallucination Cases",
    x = "AI Tool",
    y = "Frequency"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.y = element_text(size = 10),
    axis.text.x = element_text(size = 9),
    panel.grid.minor = element_blank(),
  )

```


```{r monthly-stacked-area, message = FALSE, warning = FALSE}
library(tidyverse)
library(lubridate)

parties <- c("Pro Se Litigant", "Lawyer")

month_df <- ai_data |>
  mutate(
    Date = as.Date(date),
    year = year(Date)
  ) |>
  filter(
    year >= 2023, year <= 2025,
    party %in% parties
  ) |>
  mutate(
    month = floor_date(Date, unit = "month")
  ) |>
  count(month, party, name = "n") |>
  mutate(
    party = factor(party, levels = c("Pro Se Litigant", "Lawyer"))
  )

max_total <- month_df |>
  group_by(month) |>
  summarise(total = sum(n), .groups = "drop") |>
  summarise(max_total = max(total)) |>
  pull(max_total)

upper_lim <- ceiling((max_total + 5) / 5) * 5 

ggplot(month_df,
       aes(x = month, y = n, fill = party)) +
  geom_area(alpha = 0.85, color = "white", linewidth = 0.2) +
  scale_fill_brewer(palette = "Paired") +
  scale_x_date(
    date_breaks = "2 months",
    date_labels = "%Y-%m",
    expand = expansion(mult = c(0.02, 0.05))
  ) +
  scale_y_continuous(
    limits = c(0, upper_lim),            
    breaks = seq(0, upper_lim, 10), 
    minor_breaks = seq(0, upper_lim, 5),
    expand = expansion(mult = c(0, 0))
  ) +
  labs(
    title    = "Monthly Hallucination-Related Cases (2023–2025)",
    subtitle = "Stacked Area Plot",
    x        = "Monthly Period",
    y        = "Number of Cases",
    fill     = "Party Type"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    axis.text.x   = element_text(angle = 45, hjust = 1, vjust = 1),
    axis.title.x   = element_text(size = 9),
    axis.title.y   = element_text(size = 9),
    plot.title    = element_text(size = 12, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 10, hjust = 0.5),
    legend.position = c(0.05, 0.9),
    legend.justification = c("left", "top"),
    legend.background = element_rect(fill = "white", color = NA),
    legend.title = element_text(size = 10),
    legend.text  = element_text(size = 9),
    legend.key.size = unit(0.6, "lines")
  )
```


```{r bimonthly-avg-by-party, message = FALSE, warning = FALSE}
library(tidyverse)
library(lubridate)

# Parties to include
parties <- c("Lawyer", "Pro Se Litigant")

bi_df <- ai_data |>
  mutate(
    Date = as.Date(date),
    year = year(Date)
  ) |>
  # keep 2023–2025 and only these two party types
  filter(
    year >= 2023, year <= 2025,
    party %in% parties
  ) |>
  # bimonthly period (Jan–Feb, Mar–Apr, etc.)
  mutate(
    bimonth = floor_date(Date, unit = "2 months")
  ) |>
  # number of cases in each bimonthly period and party
  count(bimonth, party, name = "avg_cases")

# order parties for legend
bi_df <- bi_df |>
  mutate(party = factor(party, levels = parties))

ggplot(bi_df, aes(x = bimonth, y = avg_cases, colour = party)) +
  geom_line(linewidth = 0.8) +
  geom_point(size = 2) +
  scale_x_date(
    date_breaks = "2 months",
    date_labels = "%Y-%m"
  ) +
  labs(
    title = "Bimonthly Average Hallucination-Related Cases (2023–2025)",
    x = "Bimonthly Period",
    y = "Average Number of Cases",
    colour = NULL
  ) +
  theme_minimal(base_size = 13) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title  = element_text(face = "bold", hjust = 0.5),
    legend.position = "top"
  )
```


